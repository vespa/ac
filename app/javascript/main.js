var getData=function(){"use strict";function t(t){return t=t||{},this.constructor=getData,this.path=t.path||"data/data.json",this.method=t.method||"get",this.success=t.success||function(t){return t.responseText},this.error=t.error||function(t){return t.statuText},this.request()}return t.createRequest=function(t,e){var r;if(window.XMLHttpRequest)r=new XMLHttpRequest;else if(window.ActiveXObject)try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){r=!1}}return r.open(t,e,!0),r},t.prototype={request:function(){var e,r=this,n=(this.constructor,t.createRequest(this.method,this.path)),o=!1;n&&(n.send(),n.onerror=function(){r.error(req)},"undefined"==typeof n.onload&&(o=!0),n.onload=function(){e=JSON.parse(n.responseText),r.success(e)},n.readyState&&o&&(n.onreadystatechange=function(){4!==n.readyState&&"loaded"!==n.readyState&&"complete"!==n.readyState||n.onload()}))}},function(e){return new t(e)}}();
var manager=function(e){"use strict";function t(e){return this.processNewMessages(e)}return t.prototype={messages:{},totalReady:0,totalUnready:0,setMessage:function(e){this.messages[e.uid]=e},dateConveter:function(e){var t=new Date(1e3*e).toUTCString();return t=t.replace(/:\d{2}\s{1,}\w{3}$/gi,"")},processNewMessages:function(e){var t=this;return e.map(function(e){e.unread=!0,e.time_sent_string=t.dateConveter(e.time_sent),t.setMessage(e)}),t.totalUnready=e.length,this}},function(e){return new t(e)}}(window);
var createInbox=function(e){function t(e){var r=e.template||"#line-inbox";return r=t.getTemplate(r),this.lines=[],this.readList=[],this.lineShow=e.lineShow||".email-list-show",this.lineDelete=e.lineShow||".email-list-delete",this.targetCounter=e.targetCounter||".email-list-title-unread-count",this.targetSubject=e.targetSubject||".email-body-title-text",this.targetBody=e.targetBody||".email-body-text",this.markAsUnreadClass=e.markAsUnreadClass||".email-tools-itens-unread",this.deleteClass=e.deleteClass||".email-tools-itens-delete",this.messages=e.messages.messages,this.template=r,this.unread=e.messages.totalUnready,this.target=e.target||".email-list-items",this.readClass=e.readClass||"read-item",this.targetActions=e.targetActions||".email-body-actions",this.hideAll=".hide-action",this.process(e)}return t.getTemplate=function(e){var t=document.createElement("div");return t.innerHTML=document.querySelector(e).innerHTML,t.querySelector("li")},t.createArray=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t=t.sort(function(e,t){return t.time_sent-e.time_sent})},t.prototype={current:0,updateCounter:function(e){var t=document.querySelector(this.targetCounter),r=this.readList;return r[e]||(this.unread=this.unread-1,this.unread=this.unread<=0?0:this.unread,t.innerHTML=this.unread,this.readList[e]=e),this},hideAction:function(){var e=e=document.querySelectorAll(this.hideAll);return e=[].slice.call(e),e.map(function(e){e.style.display="none"}),this},markAsUnread:function(){if(0===this.current)return!1;var e,t=document.querySelector(this.target).querySelector("."+this.current),r=document.querySelector(this.targetCounter);t.className.indexOf(this.readClass)!==-1&&(e=new RegExp(this.readClass,"gi"),t.className=t.className.replace(e,""),this.unread=this.unread+1,r.innerHTML=this.unread,delete this.readList[this.current])},showMessage:function(e){this.current=e;var t=this.messages[e],r=document.querySelector(this.targetSubject),s=document.querySelector(this.targetBody),n=document.querySelectorAll(this.targetActions);this.hideAction(),r.innerHTML=t.subject,s.innerHTML=t.message,s.setAttribute("data-current-message",e),n=[].slice.call(n),n.map(function(e){e.style.display="block"})},removeMessage:function(e){if(e=e||this.current,0===e)return!1;var t=(this.messages[e],document.querySelector("."+e),document.querySelector(this.targetSubject)),r=document.querySelector(this.targetBody),s=r.getAttribute("data-current-message"),n=document.querySelector(this.targetActions);return s&&s===e&&(r.innerHTML="",t.innerHTML="",n.style.display="none",this.current=0),delete this.messages[e],this.hideAction(),this.lines=[],this.process().print(),this},setBehavior:function(e,t){var r=this,s=e.querySelector(this.lineShow),n=e.querySelector(this.lineDelete),i=t.uid;return e.className+=" "+i,s.addEventListener("click",function(t){t.preventDefault(),e.className+=" "+r.readClass,r.updateCounter(i),r.showMessage(i)}),n.addEventListener("click",function(e){e.preventDefault(),r.updateCounter(i),r.removeMessage(i)}),e},setMarkAsUnread:function(){var e=document.querySelector(this.markAsUnreadClass),t=this;e.addEventListener("click",function(e){e.preventDefault(),t.markAsUnread()})},setDeleteOnCorner:function(e){var t=document.querySelector(this.deleteClass),r=this;t.addEventListener("click",function(e){e.preventDefault(),r.removeMessage()})},generateLine:function(e){var t,r=this.template.cloneNode("true"),s=r.innerHTML;for(var n in e)e.hasOwnProperty(n)&&(t=new RegExp("{{"+n+"}}","gi"),s=s.replace(t,e[n]));return e.unread||(r.className+=" read-item",r.setAttribute("data-unread",!1)),r.innerHTML=s,r},setCommands:function(e){return this.setMarkAsUnread(),this.setDeleteOnCorner(),this},process:function(){for(var e,r=(this.template,[]),s=t.createArray(this.messages),n=s.length,i=0;i<n;i++)e=this.generateLine(s[i]),e=this.setBehavior(e,s[i]),r.push(e);return this.lines=r,this},print:function(){var e=document.querySelector(this.target),t=document.querySelector(this.targetCounter),r=this.lines;return t.innerHTML=this.unread,e.innerHTML="",r.map(function(t){e.appendChild(t)}),this}},function(e){return new t(e)}}(window);
var reply=function(){"use strict";function e(e){return e=e||{},this.target=e.target||".email-body-actions ",this.replyBox=e.replyBox||".email-reply",this.textarea=e.textarea||".email-reply-body-textarea ",this.subject=e.subject||".email-reply-body-title-input",this.textOrigin=e.textOrigin||".email-body-text",this.subjectOrigin=e.subjectOrigin||".email-body-title-text",this.configure()}return e.prototype={configure:function(){var e=document.querySelector(this.target),t=document.querySelector(this.replyBox),r=document.querySelector(this.textarea),i=document.querySelector(this.subject),n=document.querySelector(this.textOrigin),u=document.querySelector(this.subjectOrigin);return e.addEventListener("click",function(e){e.preventDefault(),t.style.display="block",i.value="re: "+u.innerHTML,r.innerHTML="\n\r\n\r\n\r\n\r------\n\r"+n.innerHTML}),this}},function(t){new e(t)}}();
!function(){"use strict";var a,s;getData({path:"data/data.json",success:function(t){a=manager(t.messages),s=createInbox({target:".email-list-items",messages:a}).print().setCommands(),reply()}})}();